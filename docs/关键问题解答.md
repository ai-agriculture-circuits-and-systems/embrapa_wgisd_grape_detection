# WGISD 数据集关键问题解答

本文档直接回答关于数据集结构的6个关键问题。

---

## 1. `contrib/berries/` 目录中的 txt 文件提供什么信息？

**位置**: `/contrib/berries/{image_name}-berries.txt`

**格式**: 制表符分隔（Tab-separated）
```
1693    701
1717    695
1682    681
```

**信息内容**:
- **字段**: `x坐标  y坐标`（制表符分隔）
- **坐标系统**: 绝对像素坐标（左上角为原点）
- **用途**: 单个葡萄粒的中心点坐标，用于计数任务或关键点检测

**特点**:
- 每张图像对应一个文件
- 共 300 个文件，总计约 187,374 行标注
- 格式与 `data/origin/train_berries.txt` 不同（制表符 vs 空格，单文件 vs 合并文件）

**示例**:
- `CDY_2015-berries.txt`: 654 行 = 654 个葡萄粒
- `CDY_2017-berries.txt`: 384 行 = 384 个葡萄粒

---

## 2. `data/origin/CDY_2015.npz` 文件提供什么信息？

**文件类型**: NumPy压缩数组文件（.npz）

**数据结构**:
```python
{
    'arr_0': numpy.ndarray  # Shape: (1365, 2048, 24)
}
```

**信息内容**:
- **形状**: `(高度, 宽度, 通道数)` = `(1365, 2048, 24)`
- **数据类型**: `float64`
- **数值范围**: `[0.0, 1.0]`（二值掩码）
- **通道数**: 24 个通道，每个通道代表一个葡萄实例的分割掩码

**用途**:
- **实例分割任务**: 每个通道是一个独立的葡萄实例掩码
- **掩码格式**: 值 1.0 表示该像素属于该实例，0.0 表示背景
- **对应关系**: 与 `coco_annotations/*_polygons_instances.json` 中的多边形标注对应

**覆盖率**:
- 137 个图像有 .npz 文件（45.7% 的覆盖率）
- 不是所有图像都有分割掩码

**转换建议**:
- 可以合并所有通道生成单一掩码（union）
- 或转换为多通道PNG格式保留实例信息

---

## 3. `data/origin/CDY_2015.txt` 文件提供什么信息？

**文件类型**: YOLO 格式标注文件

**格式**: 空格分隔
```
0 0.1116 0.3026 0.0845 0.2271
0 0.5168 0.5084 0.0415 0.0645
```

**信息内容**:
- **字段**: `class_id center_x center_y width height`
  - `class_id`: 类别ID（0 = grape）
  - `center_x`: 归一化中心x坐标（0-1范围）
  - `center_y`: 归一化中心y坐标（0-1范围）
  - `width`: 归一化宽度（0-1范围）
  - `height`: 归一化高度（0-1范围）

**坐标系统**:
- **归一化坐标**: 所有值在 0-1 范围内
- **中心点格式**: 使用边界框的中心点，而不是左上角
- **对应图像**: 基于降采样后的图像（2048×1365）

**转换关系**:
- 绝对x = center_x × image_width
- 绝对y = center_y × image_height
- 左上角x = center_x × image_width - (width × image_width) / 2
- 左上角y = center_y × image_height - (height × image_height) / 2

**状态**:
- ✅ 已转换为 CSV 格式存储在 `grapes/csv/CDY_2015.csv`
- CSV 格式使用绝对像素坐标和左上角格式

---

## 4. `extra/video_demo_frames/` 目录提供什么信息？

**位置**: `/extra/video_demo_frames/`

**内容**:
- **文件数量**: 500 张视频帧图像
- **文件命名**: `frame-00001.jpg`, `frame-00002.jpg`, ...
- **文件大小**: 约 55MB（每张 140KB - 260KB）

**信息内容**:
- **用途**: 视频演示和可视化
- **格式**: JPG 格式图像
- **来源**: 从视频中提取的帧

**重要说明**:
- ⚠️ **这些帧可能没有对应的标注文件**
- ⚠️ **不属于核心数据集的一部分**
- ⚠️ **仅用于演示目的**

**建议**:
- 保留在 `extra/` 目录中作为额外资源
- 不应包含在标准化的数据集结构中
- 如需使用，需要单独标注

---

## 5. `original_resolution/` 目录提供什么信息？

**位置**: `/original_resolution/`

**内容**:
- **文件数量**: 300 张原始高分辨率图像
- **文件命名**: 与 `data/origin/` 中的图像对应

**分辨率对比**:

| 目录 | 分辨率 | 示例 (CDY_2015.jpg) | 用途 |
|------|--------|---------------------|------|
| `data/origin/` | **2048×1365** | 降采样后的图像 | ✅ 与标注对应 |
| `original_resolution/` | **5184×3456** | 原始高分辨率图像 | ⚠️ 需要重新标注 |

**重要说明**:
- ⚠️ **所有标注文件都是基于降采样后的图像（2048×1365）**
- ⚠️ **如果使用原始分辨率图像，需要重新标注或坐标转换**
- ⚠️ **坐标转换比例**: 约 2.53:1（5184/2048 ≈ 2.53）

**影响**:
- YOLO标注、CSV标注、JSON标注都基于 2048×1365
- 分割掩码（.npz）也是基于 2048×1365
- 中心点坐标也是基于 2048×1365

**建议**:
- ✅ **标准数据集应使用 `data/origin/` 中的降采样图像**
- ⚠️ `original_resolution/` 可以作为额外资源保留
- ⚠️ 如需使用原始分辨率，需要：
  1. 重新标注，或
  2. 按比例缩放所有标注坐标（×2.53）

---

## 6. `WGISD.ipynb` 文件提供什么信息？

**文件类型**: Jupyter Notebook

**内容结构**:
- **单元格数量**: 53 个（13 个 Markdown，40 个代码）
- **主要章节**:
  1. 数据集创建原因
  2. 数据集结构说明
  3. 数据加载和可视化代码
  4. 使用示例

**信息内容**:
- **文档说明**: 数据集的详细说明和使用指南
- **代码示例**: 如何加载和处理数据
- **可视化代码**: 如何可视化标注和结果

**用途**:
- 📖 数据集的使用教程
- 💻 代码示例和参考
- 📊 数据可视化示例

**建议**:
- ✅ 可以保留作为参考文档
- ✅ 也可以提取 Markdown 内容到 README 或文档中
- ✅ 代码示例可以提取到 `scripts/` 目录

---

## 总结对比表

| 问题 | 文件/目录 | 提供的信息 | 是否在标准化结构中 | 建议 |
|------|----------|-----------|-------------------|------|
| 1 | `contrib/berries/` | 葡萄粒中心点坐标（制表符格式） | ❌ 否 | 统一格式或作为额外资源 |
| 2 | `*.npz` | 多通道分割掩码（24个实例） | ⚠️ 部分（45.7%覆盖率） | 转换为PNG格式 |
| 3 | `*.txt` (YOLO) | 归一化边界框标注 | ✅ 是（已转换为CSV） | 已转换，保留原始文件 |
| 4 | `extra/video_demo_frames/` | 视频演示帧（500张） | ❌ 否 | 额外资源，不包含在核心数据集 |
| 5 | `original_resolution/` | 原始高分辨率图像（5184×3456） | ❌ 否 | 额外资源，需要重新标注 |
| 6 | `WGISD.ipynb` | 数据集说明和代码示例 | ❌ 否 | 参考文档，可提取内容 |

---

**文档创建时间**: 2025-12-10  
**相关文档**: 参见 `数据集结构详细说明.md`

